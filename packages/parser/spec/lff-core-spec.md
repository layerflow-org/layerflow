**–û—Ç–ª–∏—á–Ω–æ, —ç—Ç–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–π —à–∞–≥!**
–°–¥–µ–ª–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é "LFF DSL Core" –¥–ª—è –±–∞–∑–æ–≤–æ–≥–æ –ø–∞—Ä—Å–µ—Ä–∞ ‚Äî¬†—ç—Ç–æ —Ç–æ, —Å —á–µ–≥–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ª—é–±–æ–π –∑—Ä–µ–ª—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç.
–¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ *–∑–∞—â–∏—Ç—ã –≥—Ä–∞–Ω–∏—Ü —è–¥—Ä–∞* –º–æ–∂–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å —ç–∫–æ—Å–∏—Å—Ç–µ–º—É.

---

# üìñ –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —è–¥—Ä–∞ LFF DSL (Core Parser)

## üéØ –ú–∏—Å—Å–∏—è —è–¥—Ä–∞

**LFF Core** ‚Äî —ç—Ç–æ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π:

* –°—Ç—Ä–æ–≥–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –≥—Ä–∞—Ñ–æ–≤
* –Ø–≤–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å
* –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å —á–µ—Ä–µ–∑ –ø–ª–∞–≥–∏–Ω—ã
* –ß–µ–ª–æ–≤–µ–∫–æ- –∏ AI-—á–∏—Ç–∞–µ–º–æ—Å—Ç—å
* –ò–Ω—Ç–µ—Ä–æ–ø–µ—Ä–∞–±–µ–ª—å–Ω–æ—Å—Ç—å (–ª–µ–≥–∫–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å, –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å, –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å)

> –í—Å—ë, —á—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å –¥–æ–º–µ–Ω–Ω–æ–π —Å–µ–º–∞–Ω—Ç–∏–∫–æ–π, —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏, AST-—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è–º–∏ ‚Äî –≤—ã–Ω–µ—Å–µ–Ω–æ –≤ –ø–ª–∞–≥–∏–Ω—ã!

---

## 1. **–û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ —è–¥—Ä–∞**

### 1.1 –£–∑–ª—ã (Nodes)

```lff
Frontend
Backend
"User Service"
Database [postgres]
```

* **–ò–º—è** (—Å—Ç—Ä–æ–∫–∞, –≤ –∫–∞–≤—ã—á–∫–∞—Ö –µ—Å–ª–∏ –ø—Ä–æ–±–µ–ª—ã)
* **–¢–∏–ø(—ã)** `[type1, type2]` ‚Äî –Ω–µ—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –¥–ª—è —è–¥—Ä–∞
* **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ**: –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –±–ª–æ–∫

### 1.2 –°–≤—è–∑–∏ (Edges)

```lff
A -> B
A => B
A <-> B
A --> B
```

* `->`, `=>`, `<->`, `-->`
* –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ (`=>`) –∏ –æ–ø–∏—Å–∞–Ω–∏—è (`: desc`)
* –Ø–¥—Ä–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–µ–º–∞–Ω—Ç–∏–∫—É, —Ç–æ–ª—å–∫–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—É

### 1.3 –ë–ª–æ–∫–∏ –∏ –∏–µ—Ä–∞—Ä—Ö–∏—è

```lff
System:
  Frontend
  Backend
```

* –û—Ç—Å—Ç—É–ø—ã –ø–æ 2 –ø—Ä–æ–±–µ–ª–∞
* –ì–ª—É–±–∏–Ω–∞ –±–ª–æ–∫–æ–≤ –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞
* –°–æ–¥–µ—Ä–∂–∏–º–æ–µ ‚Äî –ª—é–±—ã–µ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å—Ç—Ä–æ–∫–∏

### 1.4 –î–∏—Ä–µ–∫—Ç–∏–≤—ã (Directives)

```lff
@title: Architecture
@version: 1.0
@import: ./other.lff
@theme: dark
```

* –ù–∞—á–∏–Ω–∞—é—Ç—Å—è —Å `@`
* –§–æ—Ä–º–∞—Ç: `@–∫–ª—é—á: –∑–Ω–∞—á–µ–Ω–∏–µ`
* –ü–∞—Ä—Å–µ—Ä –æ–±—è–∑–∞–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ –¥–∏—Ä–µ–∫—Ç–∏–≤—ã: title, version, theme, import

### 1.5 –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

```lff
# –≠—Ç–æ—Ç —Ç–µ–∫—Å—Ç –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è
```

* –í –Ω–∞—á–∞–ª–µ —Å—Ç—Ä–æ–∫–∏ –∏–ª–∏ –ø–æ—Å–ª–µ –∫–æ–¥–∞

### 1.6 –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —É–∑–ª–æ–≤/–±–ª–æ–∫–æ–≤

```lff
Backend [api]:
  port: 8080
  replicas: 3
```

* –õ—é–±–æ–π –∫–ª—é—á: –∑–Ω–∞—á–µ–Ω–∏–µ
* –¢–∏–ø –∑–Ω–∞—á–µ–Ω–∏—è: —Å—Ç—Ä–æ–∫–∞, —á–∏—Å–ª–æ, –±—É–ª–µ–≤–æ, –º–∞—Å—Å–∏–≤

### 1.7 –£—Ä–æ–≤–Ω–∏ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ (Level)

```lff
@levels: 3
System [system] @1
Frontend [web] @2+
Legacy [service] @1-2
```

* –Ø–¥—Ä–æ —Ö—Ä–∞–Ω–∏—Ç –Ω–æ–º–µ—Ä–∞ —É—Ä–æ–≤–Ω–µ–π, –Ω–µ –∑–∞–¥–∞—ë—Ç —Å–µ–º–∞–Ω—Ç–∏–∫—É

### 1.8 –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –∏ —Å—Å—ã–ª–∫–∏

```lff
UserService &user [service]
API -> *user
```

* `&user` ‚Äî ID-—É–∑–µ–ª
* `*user` ‚Äî —Å—Å—ã–ª–∫–∞

---

## 2. **–§–æ—Ä–º–∞–ª—å–Ω–∞—è –≥—Ä–∞–º–º–∞—Ç–∏–∫–∞ —è–¥—Ä–∞ (EBNF)**

```ebnf
Document        ::= (Line NEWLINE)*
Line            ::= Directive | Node | Edge | Comment | Empty | Block

Directive       ::= INDENT? '@' Identifier ':' Value

Node            ::= INDENT? Identifier AnchorDef? TypeList? LevelSpec? Properties? Block?
AnchorDef       ::= '&' Identifier
TypeList        ::= '[' Identifier (',' Identifier)* ']'
LevelSpec       ::= '@' LevelRange
LevelRange      ::= Level | Level '+' | Level '-' Level
Level           ::= Digit+

Edge            ::= INDENT? Path Arrow Path Label?
Arrow           ::= '->' | '=>' | '<->' | '-->'
Label           ::= ':' Value

Block           ::= ':' NEWLINE (INDENT Line NEWLINE)+
Properties      ::= ':' (PropertyLine | PropertyBlock)
PropertyLine    ::= Value
PropertyBlock   ::= NEWLINE (INDENT Property NEWLINE)+
Property        ::= Identifier ':' Value

Comment         ::= INDENT? '#' Text*
Empty           ::= INDENT?

Identifier      ::= Letter (Letter | Digit | '_' | '-')*
Value           ::= QuotedString | UnquotedString | Number | Boolean | ArrayLiteral
QuotedString    ::= '"' Character* '"'
UnquotedString  ::= Word+
Number          ::= Digit+ ('.' Digit+)?
Boolean         ::= 'true' | 'false'
ArrayLiteral    ::= '[' ValueList? ']'
ValueList       ::= Value (',' Value)*

INDENT          ::= '  '+  // –ö—Ä–∞—Ç–Ω–æ 2 –ø—Ä–æ–±–µ–ª–∞–º
NEWLINE         ::= '\n' | '\r\n'
```

---

## 3. **–ü—Ä–∞–≤–∏–ª–∞ –ø–∞—Ä—Å–µ—Ä–∞ —è–¥—Ä–∞**

1. **–ß—ë—Ç–∫–æ —Ä–∞–∑–ª–∏—á–∞—Ç—å core –∏ –ø–ª–∞–≥–∏–Ω—ã**

   * –õ—é–±—ã–µ –Ω–µ—Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–∏–≤—ã, —Ç–∏–ø—ã, –∏–ª–∏ —Å–≤–æ–π—Å—Ç–≤–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–∞–∫ "—Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è", –Ω–æ –Ω–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è —è–¥—Ä–æ–º.

2. **–ù–µ –∑–Ω–∞—Ç—å –æ –¥–æ–º–µ–Ω–∞—Ö!**

   * –Ø–¥—Ä–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–º—ã—Å–ª —Ç–∏–ø–∞, –¥–∏—Ä–µ–∫—Ç–∏–≤—ã, —Å–≤—è–∑–∏, —É—Ä–æ–≤–Ω—è.
   * –í—Å—ë, —á—Ç–æ –Ω–µ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ –≤—ã—à–µ ‚Äî "opaque" (–Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω–æ –¥–ª—è —è–¥—Ä–∞).

3. **–í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å**

   * –û—Ç—Å—Ç—É–ø—ã –∫—Ä–∞—Ç–Ω—ã 2, –±–ª–æ–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã, —Å–∫–æ–±–∫–∏/–∫–∞–≤—ã—á–∫–∏ –∑–∞–∫—Ä—ã—Ç—ã, ID —É–Ω–∏–∫–∞–ª—å–Ω—ã.

4. **API —è–¥—Ä–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã–º –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è**

   * –í—Å—è AST —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ –∫–ª—é—á–∏/–∑–Ω–∞—á–µ–Ω–∏—è, –Ω–æ –ø–∞—Ä—Å–µ—Ä –Ω–µ –¥–µ–ª–∞–µ—Ç –≤—ã–≤–æ–¥–æ–≤ –æ –¥–æ–º–µ–Ω–Ω–æ–π —Å–µ–º–∞–Ω—Ç–∏–∫–µ.

---

## 4. **AST —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (Core)**

```typescript
interface LFFNode {
  id?: string
  name: string
  type?: string[]
  level?: string
  metadata?: Record<string, any>
  children?: LFFNode[]
}

interface LFFEdge {
  from: string
  to: string
  arrow: '->' | '=>' | '<->' | '-->'
  label?: string
  properties?: Record<string, any>
}

interface LFFDirective {
  key: string
  value: string | number | boolean | string[]
}

interface LFFDocument {
  nodes: LFFNode[]
  edges: LFFEdge[]
  directives: LFFDirective[]
  comments?: string[]
}
```

---

## 5. **–¢–µ—Å—Ç—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —è–¥—Ä–∞**

### –ü—Ä–∏–º–µ—Ä 1: –ë–∞–∑–æ–≤—ã–π –≥—Ä–∞—Ñ

```lff
# –ú–æ–π –ø–µ—Ä–≤—ã–π –≥—Ä–∞—Ñ
Frontend [web] -> Backend [api] -> Database [postgres]
```

### –ü—Ä–∏–º–µ—Ä 2: –ë–ª–æ–∫–∏ –∏ —Å–≤–æ–π—Å—Ç–≤–∞

```lff
System:
  Frontend [web]:
    port: 3000
  Backend [api]:
    port: 4000
  Frontend -> Backend: REST
  Backend -> Database: SQL
```

### –ü—Ä–∏–º–µ—Ä 3: –î–∏—Ä–µ–∫—Ç–∏–≤—ã –∏ —É—Ä–æ–≤–Ω–∏

```lff
@title: Simple System
@levels: 2

Gateway [gateway] @1
App [service] @2
Gateway -> App: request
```

---

## 6. **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –ø–ª–∞–≥–∏–Ω—ã (–ø—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, –Ω–æ –≤–Ω–µ —è–¥—Ä–∞)**

```typescript
interface LFFPlugin {
  extendGrammar?: (builder: GrammarBuilder) => void
  transformAST?: (ast: LFFDocument) => LFFDocument
  validators?: ((ast: LFFDocument) => ValidationError[])[]
}
```